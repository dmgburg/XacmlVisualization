<html>
<style>
svg {
    background-color: beige;
}
</style>
<body>

<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://d3js.org/d3-hierarchy.v1.min.js"></script>
<script>

var body = d3.select("body");
var div = body.append("div");
div.html("Hello, world!");
d3.json("/", function (treeData) {

   // var myjson = '{"children":[{"children":[],"decision":null,"description":"Teddy bears"},{"children":[],"decision":null,"description":"Star Wars"},{"children":[],"decision":"ALLOW","description":"Disney worlds"}],"decision":"ALLOW","description":"Root"}';
   // treeData = JSON.parse( myjson )

    console.log(treeData)

    var hierarchy = d3.hierarchy(treeData)

    var treeVerticalSize = hierarchy.leaves().length;
    var treeHorizontalSize = hierarchy.height + 1;

    var nodeHorizontalMargin = 60;
    var nodeVerticalMargin = 20;

    var i = 0;
    var nodeHeight = 200;
    var nodeWidth = 300;

    // ************** Generate the tree diagram	 *****************
    var margin = {top: 20, right: 120, bottom: 20, left: 120},
    	width = (nodeWidth + nodeHorizontalMargin) * treeHorizontalSize,
    	height = (nodeHeight + nodeVerticalMargin) * (treeVerticalSize + 2);

    var tree = d3.layout.tree()
    	.size([height, width]);

    var diagonal = d3.svg.diagonal()
        .source(function(d) { return {"x":d.source.x, "y":d.source.y + nodeWidth}; })
        .target(function(d) { return {"x":d.target.x, "y":d.target.y}; })
    	.projection(function(d) { return [d.y, d.x]; });

    var svg = d3.select("body").append("svg")
    	.attr("width", width + margin.right + margin.left)
    	.attr("height", height + margin.top + margin.bottom)
        .append("g")
    	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Compute the new tree layout.
    var nodes = tree.nodes(treeData).reverse(),
     links = tree.links(nodes);

    // Normalize for fixed-depth.
    nodes.forEach(function(d) { d.y = d.depth * (nodeWidth + nodeHorizontalMargin); });

    // Declare the nodes…
    var node = svg.selectAll("g.node")
      .data(nodes, function(d) { return d.id || (d.id = ++i); });

    // Enter the nodes.
    var nodeEnter = node.enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) {
    	  return "translate(" + d.y + "," + d.x + ")"; });

    nodeEnter.append("rect")
      .attr("ry","6")
      .attr("rx","6")
      .attr("y",-nodeHeight/2)
      .attr("height",nodeHeight)
      .attr("width", nodeWidth)
      .style("stroke-width", function(d) {
        switch (d.decision){
            case 'ALLOW': return '6';
            case 'DENY': return '6';
            default: return '1';
        }
      })
      .style("stroke", function(d) {
         switch (d.decision){
         case 'ALLOW': return 'green';
         case 'DENY': return 'red';
         default: return 'grey';
         }
      })
    	  .style("fill", "none");

      nodeEnter.append("text")
    	  .attr("x", function(d) {return "6"})
    	  .attr("dy", ".35em")
    	  .attr("text-anchor", "start")
    	  .text(function(d) { return d.description; })
    	  .style("fill-opacity", 1);

      // Declare the links…
      var link = svg.selectAll("path.link")
    	  .data(links, function(d) { return d.target.id; });

      // Enter the links.
      link.enter().insert("path", "g")
    	  .attr("class", "link")
    	  .style("stroke-width", function(d) {
      	         switch (d.target.decision){
      	            case 'ALLOW': return '6';
      	            case 'DENY': return '6';
      	            default: return '1';
      	         }
      	  })
      	  .style("stroke", function(d) {
      	         switch (d.target.decision){
      	            case 'ALLOW': return 'green';
      	            case 'DENY': return 'red';
      	            default: return 'grey';
      	         }
      	  })
      	  .style("fill", "none")
    	  .attr("d", diagonal);
});

</script>
</body>
</html>